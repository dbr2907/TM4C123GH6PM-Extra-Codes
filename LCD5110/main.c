
/*
LCD 5110 (48*84) Code using Tivaware
autor@ David Josue Barrientos Rojas (2018)
d[dot]b[dot]gt[at]ieee[dot]org
*/

/*
-------------------------------
NOKIA5110        TIVA C
-------------------------------
GND (1)           GND
VCC (2)           3.3V
CLK (3)           PA2
DIN (4)           PA5
D/C (5)           PA6
CS  (6)           PA3
RST (7)           PA7
LED (8)           Not Connected
-------------------------------
*/


//********************************Librerias*****************************************//
#include <stdint.h>
#include <stdbool.h>
#include "inc/hw_memmap.h"
#include "inc/hw_types.h"
#include "inc/tm4c123gh6pm.h"
//******************************Librerias Extras************************************//
#include "driverlib/sysctl.h"
#include "driverlib/pin_map.h"
#include "driverlib/gpio.h"
#include "driverlib/ssi.h"
//*********************************Definiciones*************************************//
//**********************************Variables***************************************//
const char Heart[] = {
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE,
      0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0xC0, 0x00,
      0xC0, 0xE0, 0xF0, 0xF8, 0xFC, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE,
      0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x0F, 0x1F, 0x3F, 0x7F,
      0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
      0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F,
      0x3F, 0x1F, 0x0F, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x01, 0x03, 0x07, 0x0F, 0x1F, 0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
      0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x3F, 0x1F, 0x0F, 0x07, 0x03, 0x01, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00,
      0x80, 0x00, 0x00, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x01, 0x03, 0x07, 0x0F, 0x1F,
      0x0F, 0x87, 0x03, 0x01, 0x80, 0x00, 0x80, 0x00, 0x00, 0x80, 0x00, 0x80, 0x80, 0x80,
      0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x0B, 0x0A, 0x0E, 0x00, 0x0F, 0x0A, 0x0A, 0x08, 0x00,
      0x0F, 0x01, 0x02, 0x0F, 0x00, 0x0F, 0x08, 0x08, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x0F, 0x01, 0x02, 0x0F, 0x00, 0x0F, 0x08, 0x08, 0x0F, 0x00, 0x0F, 0x08, 0x08,
      0x07, 0x00, 0x0F, 0x0A, 0x0A, 0x08, 0x00, 0x0B, 0x0A, 0x0E, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
//***********************************Metodos****************************************//
void Nokia5110_Draw(const char *ptr){
  int i;
  for(i=0; i<(48*84/8); i=i+1){
      SSIDataPut(SSI0_BASE, ptr[i]);
  }
}

void SPI_Setup(void){
    GPIOPinConfigure(GPIO_PA2_SSI0CLK);
    GPIOPinConfigure(GPIO_PA3_SSI0FSS);
    GPIOPinConfigure(GPIO_PA5_SSI0TX);
    GPIOPinTypeSSI(GPIO_PORTA_BASE, GPIO_PIN_2 | GPIO_PIN_3 | GPIO_PIN_5);
    SSIDisable(SSI0_BASE);
    SSIConfigSetExpClk(SSI0_BASE, SysCtlClockGet(), SSI_FRF_MOTO_MODE_0, SSI_MODE_MASTER, 2000000, 8);
     while(SSIBusy(SSI0_BASE)){}
     SSIEnable(SSI0_BASE);
     while(SSIBusy(SSI0_BASE)){}
}

void Reset_Screen(void){
    GPIOPinWrite(GPIO_PORTA_BASE, GPIO_PIN_7, 0);
    SysCtlDelay(50000);
    GPIOPinWrite(GPIO_PORTA_BASE, GPIO_PIN_7, GPIO_PIN_7);
}

void N5110_Init(void){
    GPIOPinWrite(GPIO_PORTA_BASE, GPIO_PIN_6, 0);
    SSIDataPut(SSI0_BASE, 0x21);// Chip active
    SSIDataPut(SSI0_BASE, 0xB8);// 0xB8 (for 3.3V blue SparkFun)
    SSIDataPut(SSI0_BASE, 0x04);// Set temp coefficient
    SSIDataPut(SSI0_BASE, 0x14);// LCD bias mode 1:48
    SSIDataPut(SSI0_BASE, 0x20);// Send 0x20 before modifying the display control mode
    SSIDataPut(SSI0_BASE, 0x0C);// Set display control to normal mode
    SSIDataPut(SSI0_BASE, 0x80);// x origin 0
    SSIDataPut(SSI0_BASE, 0x40);// y origin 0
    while(SSIBusy(SSI0_BASE)){}
    GPIOPinWrite(GPIO_PORTA_BASE, GPIO_PIN_6, GPIO_PIN_6);
    SysCtlDelay(10);
}

void N5110_SetCursor(unsigned char newX, unsigned char newY){
  if((newX > 11) || (newY > 5)){return;} //bad input
  GPIOPinWrite(GPIO_PORTA_BASE, GPIO_PIN_6, 0);
  SSIDataPut(SSI0_BASE, 0x80|(newX*7));     // setting bit 7 updates X-position
  SSIDataPut(SSI0_BASE, 0x40|newY);         // setting bit 6 updates Y-position
  GPIOPinWrite(GPIO_PORTA_BASE, GPIO_PIN_6, GPIO_PIN_6);
  SysCtlDelay(10);
}

void N5110_Clear(void){
  int i;
  for(i=0; i<(48*84/8); i=i+1){
      SSIDataPut(SSI0_BASE, 0x00);
  }
  N5110_SetCursor(0, 0);
}


//************************************Main******************************************//
int main(void){

    SysCtlClockSet(SYSCTL_XTAL_16MHZ|SYSCTL_SYSDIV_4);
    SysCtlPeripheralEnable(SYSCTL_PERIPH_SSI0);
    SysCtlPeripheralEnable(SYSCTL_PERIPH_GPIOA);

    GPIOPinTypeGPIOOutput(GPIO_PORTA_BASE, GPIO_PIN_6|GPIO_PIN_7);

    SPI_Setup();
    Reset_Screen();
    N5110_Init();

    N5110_Clear();
	while(1){
        Nokia5110_Draw(Heart);
        SysCtlDelay(SysCtlClockGet()/3);
	}
}
